# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview
This is a Next.js 15 SaaS starter template with integrated authentication (Clerk) and real-time database (Convex). Billing and payments have been removed in this fork to create a clean foundation for new projects.

## Development Commands

### Core Development
- `npm run dev` - Start development server with Turbopack on http://localhost:3000
- `npm run build` - Build production bundle
- `npm start` - Start production server  
- `npm run lint` - Run Next.js linting

### Convex Development
- `npx convex dev` or `bunx convex dev` - Start Convex development server (required for database)
- This must be run in a separate terminal alongside `npm run dev` for full functionality

### Component Installation
- `bunx --bun shadcn@latest add [component-name]` - Install shadcn/ui components (preferred over npx)
- If dependency installation fails, manually install with `bun install [dependency-name]`

## Architecture Overview

### Tech Stack Core
- **Next.js 15** with App Router and Turbopack for fast development
- **Convex** for real-time database and serverless backend functions
- **Clerk** for complete authentication and user management
- **TailwindCSS v4** with shadcn/ui component library
- **TypeScript** throughout with strict type checking

### Authentication Flow Architecture
1. **Clerk Middleware** (`middleware.ts`) protects `/dashboard(.*)` routes
2. **JWT Configuration** requires "convex" template in Clerk dashboard with issuer URL
3. **User Sync** via webhooks at `/api/webhook` handled by `convex/http.ts`
4. **Database Sync** users automatically synced from Clerk to Convex `users` table

### Database Architecture (Convex)
- **Real-time Sync** provided by Convex with automatic client updates
- **Schema Location** defined in `convex/schema.ts`
- **User Table** structure: `{name: string, externalId: string}` where `externalId` maps to Clerk user ID
- **Index** on `externalId` for efficient user lookups

### Project Structure Patterns
```
app/
├── (landing)/         # Public marketing pages (route groups)
├── dashboard/         # Protected application area
├── layout.tsx         # Root layout with ConvexClientProvider + ClerkProvider
└── middleware.ts      # Route protection logic

convex/
├── schema.ts          # Database schema definitions
├── users.ts           # User CRUD operations and sync functions  
├── http.ts            # Webhook handlers for Clerk events
└── auth.config.ts     # JWT configuration for Clerk integration

components/
├── ui/               # shadcn/ui component library
├── ConvexClientProvider.tsx  # Convex client wrapper
└── theme-provider.tsx        # Dark/light theme support
```

### Real-time Data Flow
1. UI components use Convex hooks (`useQuery`, `useMutation`, `useAction`)
2. Convex provides automatic real-time updates to all connected clients
3. Authentication context from Clerk's `useAuth()` and `useUser()` hooks
4. User data automatically synced between Clerk and Convex via webhooks

## Environment Configuration

### Required .env.local Variables
```bash
# Convex (generated by `npx convex dev`)
CONVEX_DEPLOYMENT=your-deployment-url
NEXT_PUBLIC_CONVEX_URL=your-convex-client-url

# Clerk Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_your_key
CLERK_SECRET_KEY=sk_test_your_secret

# Clerk JWT Template URL (critical for Convex integration)
NEXT_PUBLIC_CLERK_FRONTEND_API_URL=https://your-clerk-frontend-api-url.clerk.accounts.dev

# Redirect URLs
NEXT_PUBLIC_CLERK_SIGN_IN_FORCE_REDIRECT_URL=/dashboard
NEXT_PUBLIC_CLERK_SIGN_UP_FORCE_REDIRECT_URL=/dashboard
```

### Convex Dashboard Variables
```bash
CLERK_WEBHOOK_SECRET=whsec_your_webhook_secret
NEXT_PUBLIC_CLERK_FRONTEND_API_URL=https://your-clerk-frontend-api-url.clerk.accounts.dev
```

## Integration Requirements

### Clerk JWT Template Setup (Critical)
1. Create JWT template named "convex" in Clerk dashboard
2. Copy the Issuer URL as `NEXT_PUBLIC_CLERK_FRONTEND_API_URL`
3. Add this URL to both .env.local and Convex environment variables
4. This enables Convex to validate Clerk JWT tokens

### Webhook Configuration
- **Endpoint**: `${NEXT_PUBLIC_CONVEX_URL}/api/webhook`
- **Events**: `user.created`, `user.updated`, `user.deleted`
- **Security**: Uses Svix library to verify webhook signatures
- **Handler**: Located in `convex/http.ts`

## Development Patterns

### Convex Function Standards
- Use new function syntax with explicit args and returns validators
- Public functions: `query`, `mutation`, `action`
- Internal functions: `internalQuery`, `internalMutation`, `internalAction`
- Always include return type validators (use `v.null()` for void functions)

### Authentication Patterns
- Use `getCurrentUser()` from `convex/users.ts` to get current user
- Use `getCurrentUserOrThrow()` for functions requiring authentication
- User lookup by Clerk ID via `userByExternalId()` helper function

### File Organization Rules
- All source files must be under 300 lines of code
- Single purpose per file (registry, CLI, validation, etc.)
- Break into sub-modules when approaching 300 LOC limit
- Separate concerns: File I/O, prompting, validation in distinct modules

### Code Standards
- No assumptions about user intent or file formats without validation
- Validate JSON against defined interfaces rather than assuming correctness
- Consider 2-3 approaches for major decisions, document trade-offs in comments
- Use explicit error handling with logging and fallbacks
- Perform full steps even if repetitive - no "intelligent" assumptions

## Component Architecture

### UI Components (shadcn/ui)
- Consistent component library with Radix UI primitives
- Dark/light theme support via next-themes
- Custom animations using Framer Motion and Motion Primitives
- Responsive design with mobile-first approach

### Layout Structure
- Root layout provides Clerk and Convex providers
- Route groups for organizing public vs protected areas
- Custom 404 page with animations
- Sidebar navigation pattern for dashboard area

## Deployment Considerations

### Vercel Deployment (Recommended)
- Optimized for Vercel with automatic Turbopack builds
- Environment variables configured in Vercel dashboard
- Edge function support for API routes
- Automatic deployments on push to main branch

### Environment Variable Sync
- Ensure Convex and Next.js environment variables match
- Webhook secrets must be set in Convex dashboard
- Clerk JWT configuration must match across both platforms